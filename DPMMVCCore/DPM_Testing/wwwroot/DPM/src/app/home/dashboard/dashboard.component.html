<style>
    a.disabled {
        pointer-events: none;
        cursor: default;
    }
    
    a.pointer {
        cursor: pointer;
    }
</style>
<p-toast position="top-center"></p-toast>

<div class="container-fluid">
    <h1 class="h3 mb-2 text-gray-800">Dashboard</h1>
    <div class="row">

        <div class="col-xl-8 col-lg-7">
            <div class="card shadow mb-4">
                <div style="color: #585570;" class="card-header py-3">
                    <h6 class="m-0 font-weight-bold">Illustrations</h6>
                </div>
                <div class="card-body">
                    <div class="text-center">
                        <img class="img-fluid px-3 px-sm-4 mt-3 mb-2" src="dist/DPM/assets/img/undraw_posting_photo.svg" alt="">
                    </div>
                    <p> <b>Dynamic Prescriptive Maintenance</b> <br> Conventional Maintenance practices are (1)Reactive, (2)Preventive, and (3)Predictive. <br> Organizations are gradually adopting Proactive maintenance practice. In the digital age, a new
                        maintenance practice is evolving, called Prescriptive. Dynamic Prescriptive Maintenance (D.P.M.) is the methodology that enables data capturing in near-real-time (dynamic); applies artificial intelligence to recognize pattern &
                        forecast future failure; and prescribes just-in-time maintenance tasks, to minimize business risk and maximize profitability.</p>
                    <a style="color:#585570;" href="https://linkedin.com/in/dynamic-prescriptive-maintenance-08bb101b8">Browse Illustrations on
                                LinkedIn &rarr;</a>
                </div>
            </div>
        </div>

        <div class="col-xl-4 col-lg-5">
            <div class="card shadow mb-4">
                <div class="card-header py-3">
                    <h6 style="color: #585570;" class="m-0 font-weight-bold">DPM (Product Development Progress)</h6>
                </div>
                <div class="card-body">
                    <h4 class="small font-weight-bold">Compressor<span class="float-right">60%</span></h4>
                    <div class="progress">
                        <div class="progress-bar bg-success" role="progressbar" style="width: 60%" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"></div>
                    </div> <br>

                    <h4 class="small font-weight-bold">Pumps Under Progress <span class="float-right">10%</span></h4>
                    <div class="progress mb-4">
                        <div class="progress-bar" role="progressbar" style="width: 10%" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>

                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-xl-12 col-lg-11">
            <div class="card prescriptive shadow mb-4 con" *ngIf="!(user.UserType == 3)">
                <div class="card-header">
                    <h6 style="color: #585570;" class="m-0 font-weight-bold " class="card-header-title font-size-lg text-capitalize font-weight-normal"><i class="fa fa-tasks"></i>&nbsp;Prescriptive Equipment List</h6>
                    <div class="col" *ngIf="Table2">
                        <button type="button" style="float: right" class="btn btn-secondary btn-sm" (click)="BackToTable1()">Back</button>

                    </div>
                </div>
                <div class="card-body">
                    <p-table *ngIf="Table1" id="exportexcel" [scrollable]="true" [style]="{width:'100%'}" [value]="prescriptiveRecords" [paginator]="true" [rowHover]="true" [rows]="10" [showCurrentPageReport]="true" currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
                        [rowsPerPageOptions]="[10,25,50]" [loading]="loading">
                        <ng-template pTemplate="colgroup">
                            <colgroup>
                                <col style="width:5em;">
                                <col style="width:6em;">
                                <col style="width:10em;">
                                <col style="width:7em;">
                                <col style="width:6em;">
                                <col style="width:13em;">
                                <col style="width:15em;">
                                <col style="width:11em;">
                                <col style="width:16em;">
                                <col style="width:10em;">
                                <col style="width:8em;">
                                <col style="width:6em;">
                            </colgroup>
                        </ng-template>
                        <ng-template pTemplate="header">
                            <tr>
                                <th>Sr. No </th>
                                <th>Assets </th>
                                <th>Sub Units </th>
                                <th>Tag No. </th>
                                <th>Tree</th>
                                <th>Consequence </th>
                                <th>Component Criticality Factor </th>
                                <th>Component Rating</th>
                                <th>Maintainenance Practice</th>
                                <th>Attachment</th>
                                <th>Report</th>
                                <th>Delete</th>

                            </tr>
                        </ng-template>
                        <ng-template pTemplate="body" let-p let-rowIndex="rowIndex">
                            <tr>
                                <td (click)="FailureModeTable(p)">{{rowIndex + 1}}</td>
                                <td (click)="FailureModeTable(p)">{{p.MachineType}}</td>
                                <td (click)="FailureModeTable(p)">{{p.EquipmentType}}</td>
                                <td (click)="FailureModeTable(p)">{{p.TagNumber}}</td>
                                <td>
                                    <a style="color: green;" title="Update FMECA Tree" (click)="UpdatePrescriptiveRecords(p)" [ngClass]="{disabled:p.FMWithConsequenceTree.length == 0}"><i class="fa fa-edit"></i></a>
                                </td>
                                <td>
                                    <a style="color: green;" title="Add Consequence" (click)="ADDConsequenceRecords(p)" [ngClass]="{disabled:p.FMWithConsequenceTree.length > 0}"><i class="pi pi-plus"></i></a>
                                </td>
                                <td (click)="FailureModeTable(p)">{{p.ComponentCriticalityFactor}}</td>
                                <td (click)="FailureModeTable(p)">{{p.ComponentRating}}</td>
                                <td (click)="FailureModeTable(p)">{{p.CMaintainenancePractice}}</td>
                                <td>
                                    <a *ngIf="(p.CAttachmentDBPath == null)" label="Next" style="margin: 20px" (click)="getAttachmentID(p)" data-toggle="modal" data-target="#AttachmentModal"> <i class="fa fa-paperclip" aria-hidden="true"></i></a>
                                    <a *ngIf="(p.CAttachmentDBPath != null)" label="Next" style="margin: 20px" (click)="ViewAttachment(p)" data-toggle="modal" data-target="#CommentModal"><i class="fa fa-eye" aria-hidden="true"></i></a>
                                    <a *ngIf="(p.CAttachmentDBPath != null)" label="Next" style="margin: 20px" (click)="getAttachmentID(p)" data-toggle="modal" data-target="#AttachmentModal"><i class="fa fa-edit" aria-hidden="true"></i></a>
                                </td>
                                <td>
                                    <a [routerLink]="['/Home/Prescriptive/Report']" label="Next" style="margin: 20px;" (click)="FMEAReports(p)"><i class="fa fa-edit" aria-hidden="true"> Report</i></a>
                                </td>
                                <td>
                                    <a style="color: red;" title="Delete FMECA Tree" (click)="DeletePrescriptiveRecords(p)" data-toggle="modal" data-target="#DeleteTree"><i class="pi pi-trash"></i></a>
                                </td>
                            </tr>
                            <tr *ngIf="prescriptiveRecords.length == 0">
                                <td style="text-align:center; margin-top: 20px;" colspan="10">No Records to show</td>
                            </tr>
                        </ng-template>
                    </p-table>
                    <p-table *ngIf="Table2" id="exportexcel" [scrollable]="true" [style]="{width:'100%'}" [value]="FailureModeDataTabe2" [paginator]="true" [rowHover]="true" [rows]="10" [showCurrentPageReport]="true" currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
                        [rowsPerPageOptions]="[10,25,50]" [loading]="loading">
                        <ng-template pTemplate="colgroup">
                            <colgroup>
                                <col style="width:5em;">
                                <col style="width:10em;">
                                <col style="width:9em;">
                                <col style="width:9em;">
                                <col style="width:10em;">
                                <col style="width:7em;">
                                <col style="width:15em;">
                                <col style="width:15em;">
                                <col style="width:13em;">
                                <col style="width:10em;">
                            </colgroup>
                        </ng-template>
                        <ng-template pTemplate="header">
                            <tr>
                                <th>Sr. No</th>
                                <th>Failure Mode</th>
                                <th>Local Effect</th>
                                <th>System Effect</th>
                                <th>Criticality Factor</th>
                                <th>Rating</th>
                                <th>Maintainenance Practice</th>
                                <th>Frequency Maintainenance</th>
                                <th>Condition Monitoring</th>
                                <th>Consequence</th>
                            </tr>
                        </ng-template>
                        <ng-template pTemplate="body" let-p let-rowIndex="rowIndex">
                            <tr>
                                <td>{{rowIndex + 1}}</td>
                                <td class="text-truncate" pTooltip="{{p.FunctionMode}}" tooltipPosition="top">{{p.FunctionMode}}</td>
                                <td>{{p.LocalEffect}}</td>
                                <td>{{p.SystemEffect}}</td>
                                <td>{{p.CriticalityFactor}}</td>
                                <td>{{p.Rating}}</td>
                                <td>{{p.MaintainenancePractice}}</td>
                                <td class="text-truncate" pTooltip="{{p.FrequencyMaintainenance}}" tooltipPosition="top">{{p.FrequencyMaintainenance}}</td>
                                <td>{{p.ConditionMonitoring}}</td>
                                <td>{{p.Consequence}}</td>
                            </tr>
                            <tr *ngIf="FailureModeDataTabe2.length == 0">
                                <td style="text-align:center; margin-top: 20px;" colspan="10">No Records to show</td>
                            </tr>
                        </ng-template>
                    </p-table>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <!-- line Chart -->
        <div class="col-xl-8 col-lg-7">
            <div class="card shadow mb-4" *ngIf="!(user.UserType == 3)">
                <div class="card-header py-3">
                    <h6 style="color: #585570;" class="m-0 font-weight-bold ">{{CompressorType}} Real Time Line Chart</h6>
                    <form class="form-inline">
                        <div class="form-group mb-2">
                            <select [ngModelOptions]="{standalone: true}" (change)="SelectCompressorType()" class="form-select" [(ngModel)]="CompressorType" class="form-control" name="CompressorType">
                                 <option value="">Compressor Type</option>
                                 <option value="ScrewCompressor">Screw Compressor</option>
                                 <option value="ScrewCompressor2" disabled>Screw Compressor 2</option>                      
                             </select>
                        </div>
                        <div class="form-select" class="form-group mx-sm-3 mb-2">
                            <select [ngModelOptions]="{standalone: true}" (change)="TrainPredict()" [(ngModel)]="TrainPredictType" class="form-select" class="form-control" name="TrainAndPredictions">
                                  <option value="">Select Type</option>
                                  <option value="Train">Train</option>
                                  <option value="Prediction">Prediction</option>
                             </select>
                        </div>

                        <div class="form-group mx-sm-3 mb-2">
                            <select class="form-select" [ngModelOptions]="{standalone: true}" (change)="TrainPredict()" [(ngModel)]="SelectDateType" class="form-control" name="Date">
                               <option value="">Select date</option>
                               <option value="LastUpload">Last Upload</option>
                               <option value="PreviousWeek">Previous Week</option>
                               <option value="PreviousMonth">Previous Month</option>
                               <option value="TillFirstUpload">Till First Upload</option>  
                             </select>
                        </div>
                    </form>


                </div>
                <div class="card-body">
                    <div class="chart-real ">
                        <canvas id="RealContainer" width="600" height="400"></canvas>
                    </div>
                </div>


            </div>
            <div class="card shadow mb-4" *ngIf="!(user.UserType == 3)">
                <div class="card-header ">
                    <h6 style="color: #585570;" class="m-0 font-weight-bold ">{{CompressorType}} Line Chart</h6>
                </div>
                <div class="card-body">
                    <div class="chart-line">
                        <canvas id="LineContainer" width="600" height="400"></canvas>

                    </div>

                </div>
            </div>
        </div>
        <div class="col-xl-4 col-lg-5">
            <div class="card shadow mb-4" *ngIf="!(user.UserType == 3)">
                <!-- Card Header - Dropdown -->
                <div class="card-header py-3">
                    <h6 style="color: #585570;" class="m-0 font-weight-bold">Pie Chart</h6>
                </div>
                <!-- Card Body -->
                <div class="card-body">
                    <div class="chart-pie pt-4">
                        <canvas id="pie" width="400" height="400"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>


<div class="modal fade" id="DeleteTree" tabindex="-1" role="dialog" aria-labelledby="DeleteTreeTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLongTitle">Warning</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
            </div>
            <div class="modal-body">
                Are you sure you want to delete Centrifugal Pump : {{DeleteTreeName}}
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" data-dismiss="modal" (click)="SoftDeletePrescriptiveRecords()">Save</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="AttachmentModal" tabindex="-1" role="dialog" aria-labelledby="AttachmentModal" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <span>
                   {{fileToUpload != null ? 'Update' : 'Add'}} Attachment & Remark
                </span>
                <button type="button" class="btn btn-dark" class="close" data-dismiss="modal" aria-label="Close" (click)="CloseAttachmentModal()">
          <span aria-hidden="true">&times;</span>
        </button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-12">
                        <div class="input-group mb-3">
                            <div class="input-group-prepend">
                                <span class="input-group-text" id="uploadAttachments">Upload</span>
                            </div>
                            <div class="custom-file">
                                <input type="file" accept="image/x-png,image/jpeg,.pdf," (change)="uploadFile($event)" class="custom-file-input" id="uploadAttachments" aria-describedby="uploadAttachments">
                                <label class="custom-file-label" *ngIf="fileUpload == ''" for="inputGroupFile01">Attachment</label>
                                <label class="custom-file-label" *ngIf="fileUpload != ''" for="inputGroupFile01">{{fileUpload}}</label>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-12">
                        <div class="input-group mb-3">
                            <textarea class="form-control custom-textarea" [(ngModel)]="CRemarks" id="message" name="body" rows="3" placeholder="Add Remark Here"></textarea>
                        </div>

                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal" (click)="saveAttachment()">Done</button>
                </div>

            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="CommentModal" tabindex="-1" role="dialog" aria-labelledby="CommentModal" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <span>
                   <h3>Attachment & Remark</h3> 
                </span>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                         <span aria-hidden="true" >&times;</span>
                    </button>
            </div>

            <div class="modal-body">
                <div class="row ">
                    <div class="col-md-12">
                        <div class="text-center">
                            <label for="file " style="font-size: 1.3em; font-weight: bold; border-bottom: 2px solid; margin: 13px; ">Uploaded File</label>
                            <div class="text-center" *ngIf="PdfEnable " style="margin: 10px; " id="file ">
                                <iframe [src]="FileSafeUrl " width="480 " height="300 "> </iframe>
                            </div>
                            <div *ngIf="ImageEnable " style="margin: 10px; " id="file ">
                                <img [src]="FileSafeUrl " width="480 " height="300 ">
                            </div>
                        </div>
                    </div>
                    <div class="col-md-12">
                        <div class="text-center " style="margin-bottom: 10px; ">
                            <label for="remark " style="font-size: 1.3em; font-weight: bold; border-bottom: 2px solid; margin: 13px; ">Remark</label>
                            <div *ngIf="CRemarks !=='' " id="remark ">
                                <textarea class="custom-textarea " cols="60 " rows="4 ">{{CRemarks}}</textarea>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>