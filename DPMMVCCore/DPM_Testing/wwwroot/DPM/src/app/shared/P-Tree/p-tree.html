<ng-template [ngIf]="node">
    <li *ngIf="tree.droppableNodes" class="p-treenode-droppoint" [ngClass]="{'p-treenode-droppoint-active':draghoverPrev}" (drop)="onDropPoint($event,-1)" (dragover)="onDropPointDragOver($event)" (dragenter)="onDropPointDragEnter($event,-1)" (dragleave)="onDropPointDragLeave($event)"></li>
    <li *ngIf="!tree.horizontal" [ngClass]="['p-treenode',node.styleClass||'', isLeaf() ? 'p-treenode-leaf': '']">
        <div class="p-treenode-content" [style.paddingLeft]="(level * indentation)  + 'rem'" (click)="onNodeClick($event)" (contextmenu)="onNodeRightClick($event)" (touchend)="onNodeTouchEnd()" (drop)="onDropNode($event)" (dragover)="onDropNodeDragOver($event)"
            (dragenter)="onDropNodeDragEnter($event)" (dragleave)="onDropNodeDragLeave($event)" [draggable]="tree.draggableNodes" (dragstart)="onDragStart($event)" (dragend)="onDragStop($event)" [attr.tabindex]="0" [ngClass]="{'p-treenode-selectable':tree.selectionMode && node.selectable !== false,'p-treenode-dragover':draghoverNode, 'p-highlight':isSelected()}"
            role="treeitem" (keydown)="onKeyDown($event)" [attr.aria-posinset]="this.index + 1" [attr.aria-expanded]="this.node.expanded" [attr.aria-selected]="isSelected()" [attr.aria-label]="node.label">
            <button type="button" class="p-tree-toggler p-link" (click)="toggle($event)" pRipple tabindex="-1">
                <span class="p-tree-toggler-icon pi pi-fw" [ngClass]="{'pi-chevron-right':!node.expanded,'pi-chevron-down':node.expanded}"></span>
            </button>
            <div class="p-checkbox p-component" [ngClass]="{'p-checkbox-disabled': node.selectable === false}" *ngIf="tree.selectionMode == 'checkbox'" [attr.aria-checked]="isSelected()">
                <div class="p-checkbox-box" [ngClass]="{'p-highlight': isSelected(), 'p-indeterminate': node.partialSelected}">
                    <span class="p-checkbox-icon pi" [ngClass]="{'pi-check':isSelected(),'pi-minus':node.partialSelected}"></span>
                </div>
            </div>
            <span [class]="getIcon()" *ngIf="node.icon||node.expandedIcon||node.collapsedIcon"></span>
            <span class="p-treenode-label">
                    <span *ngIf="!tree.getTemplateForNode(node)">{{node.label}}</span>
            <span *ngIf="tree.getTemplateForNode(node)">
                        <ng-container *ngTemplateOutlet="tree.getTemplateForNode(node); context: {$implicit: node}"></ng-container>
                    </span>
            <div *ngIf="showOverlay" style="
                        position: relative;
                        width: 35em;
                        border: none;
                        border-radius: 0.3em;
                        background-color: #fff;
                        box-shadow: 0 0 2px rgb(0 0 0 / 12%), 0 2px 4px rgb(0 0 0 / 15%);
                        padding: 10px;">
                <a (click)="close(node)" style="position: absolute;
                                            right: 2px;
                                            top: 0;
                                            color: red;">
                    <i class="pi pi-times-circle"></i>
                </a>&nbsp;&nbsp;
                <a (click)="downloadURI()" style="position: absolute;
                                            right: 28px;
                                            top: 0;
                                            color: blue;">
                    <i class="pi pi-download"></i>
                </a>
                <div class="text-center">
                    <label for="file" class="custom-label">Uploaded File</label>
                    <div *ngIf="PdfEnable" style="margin: 10px;" id="file">
                        <iframe [src]="FileSafeUrl" width="500" height="300"> </iframe>
                    </div>
                    <div *ngIf="ImageEnable" style="margin: 10px;" id="file">
                        <img [src]="FileSafeUrl" width="500" height="300">
                    </div>
                </div>
                <div class="text-center" style="margin-bottom: 10px;">
                    <label for="remark" class="custom-label">Remark</label>
                    <div *ngIf="Remark !== ''" id="remark">
                        <textarea class="custom-textarea" cols="60" rows="4">{{Remark}}</textarea>
                    </div>
                </div>
            </div>
            <button *ngIf="!!node.edit" title="View Attachments" type="button" style="margin-left:10px; margin-top: 10px;" class="btn btn-secondary btn-sm" (click)="NodeSelection(node);"><i class="pi pi-eye"></i></button>

            </span>

        </div>
        <ul class="p-treenode-children" style="display: none;" *ngIf="!tree.virtualScroll && node.children && node.expanded" [style.display]="node.expanded ? 'block' : 'none'" role="group">
            <p-treeNode *ngFor="let childNode of node.children;let firstChild=first;let lastChild=last; let index=index; trackBy: tree.trackBy" [node]="childNode" [parentNode]="node" [firstChild]="firstChild" [lastChild]="lastChild" [index]="index" [style.height.px]="tree.virtualNodeHeight"
                [level]="level + 1"></p-treeNode>
        </ul>
    </li>
    <li *ngIf="tree.droppableNodes&&lastChild" class="p-treenode-droppoint" [ngClass]="{'p-treenode-droppoint-active':draghoverNext}" (drop)="onDropPoint($event,1)" (dragover)="onDropPointDragOver($event)" (dragenter)="onDropPointDragEnter($event,1)" (dragleave)="onDropPointDragLeave($event)"></li>
    <table *ngIf="tree.horizontal" [class]="node.styleClass">
        <tbody>
            <tr>
                <td class="p-treenode-connector" *ngIf="!root">
                    <table class="p-treenode-connector-table">
                        <tbody>
                            <tr>
                                <td [ngClass]="{'p-treenode-connector-line':!firstChild}"></td>
                            </tr>
                            <tr>
                                <td [ngClass]="{'p-treenode-connector-line':!lastChild}"></td>
                            </tr>
                        </tbody>
                    </table>
                </td>
                <td class="p-treenode" [ngClass]="{'p-treenode-collapsed':!node.expanded}">
                    <div class="p-treenode-content" tabindex="0" [ngClass]="{'p-treenode-selectable':tree.selectionMode,'p-highlight':isSelected()}" (click)="onNodeClick($event)" (contextmenu)="onNodeRightClick($event)" (touchend)="onNodeTouchEnd()" (keydown)="onNodeKeydown($event)">
                        <span class="p-tree-toggler pi pi-fw" [ngClass]="{'pi-plus':!node.expanded,'pi-minus':node.expanded}" *ngIf="!isLeaf()" (click)="toggle($event)"></span>
                        <span [class]="getIcon()" *ngIf="node.icon||node.expandedIcon||node.collapsedIcon"></span>
                        <span class="p-treenode-label">
                            <span *ngIf="!tree.getTemplateForNode(node)">{{node.label}}</span>
                        <span *ngIf="tree.getTemplateForNode(node)">
                                <ng-container *ngTemplateOutlet="tree.getTemplateForNode(node); context: {$implicit: node}"></ng-container>
                            </span>
                        </span>

                    </div>
                </td>
                <td class="p-treenode-children-container" *ngIf="node.children && node.expanded" [style.display]="node.expanded ? 'table-cell' : 'none'">
                    <div class="p-treenode-children">
                        <p-treeNode *ngFor="let childNode of node.children;let firstChild=first;let lastChild=last; trackBy: tree.trackBy" [node]="childNode" [firstChild]="firstChild" [lastChild]="lastChild"></p-treeNode>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</ng-template>